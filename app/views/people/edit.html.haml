- page_title("#{t("edit.#{@person.type}")}: #{@person.to_label}")

%h1= "#{t("edit.#{@person.type}")}: #{@person.to_label}"

.personal_data
  %h3= t('personal_data')
  = form_for @person, html: {class: 'form-compact'} do |f|
    = render partial: 'person_fields', locals: {f: f}
    .actions
      = submit_tag t("save.#{@person.type}"), class: 'btn btn-primary'

.tabbed
  .tabs
    .tab.current{data: {'tab-content-ref' => 'person_payments'}}= t('tab.person_payments')
    - if @person.is_teacher?
      .tab{data: {'tab-content-ref' => 'payments_to_teacher'}}= t('tab.payments_to_teacher')
    .tab{data: {'tab-content-ref' => 'debts'}}= t('tab.debts')
    .tab{data: {'tab-content-ref' => 'memberships'}}= t('tab.memberships')
  .tabs_contents
    .tab_content.current{data: {'tab-content' => 'person_payments'}}
      %table.table.table-striped.table-sm
        %thead.thead-dark
          %tr
            %th= t('activerecord.attributes.money_transaction.date')
            %th= t('activerecord.attributes.money_transaction.description')
            %th= t('activerecord.attributes.money_transaction.amount')
            %th.actions
        %tbody
          - @person_payments.each do |p|
            %tr
              %td{title: l(p.created_at)}= l p.created_at, format: :date
              %td= p.description
              %td= p.amount
              %td.actions
      .actions
        = link_to t('add.payment'), add_payment_person_path(@person), class: 'button', remote: true

    - if @person.is_teacher?
      .tab_content{data: {'tab-content' => 'payments_to_teacher'}}
        %table.table.table-striped.table-sm
          %thead.thead-dark
            %tr
              %th= t('activerecord.attributes.money_transaction.date')
              %th= t('activerecord.attributes.money_transaction.description')
              %th= t('activerecord.attributes.money_transaction.amount')
              %th.actions
          %tbody
            - @payments_to_person.each do |p|
              %tr
                %td{title: l(p.created_at)}= l p.created_at, format: :date
                %td= p.description
                %td= p.amount
                %td.actions
        .actions
          = link_to t('add.payment'), add_payment_done_person_path(@person), class: 'button', remote: true

    .tab_content.debts{data: {'tab-content' => 'debts'}}
      Lelelele

    .tab_content.memberships{data: {'tab-content' => 'memberships'}}
      .selector
        = select_tag :membership, options_from_collection_for_select(@person.memberships, :id, :to_label), class: 'form-control'
        = link_to t('add.membership'), new_membership_person_path(@person), class: 'btn btn-light', remote: true
      .installments
        - if m = @person.memberships.first
          = render partial: 'people/membership', locals: {membership: m}
